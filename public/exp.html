<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="public/assets/style.css">
    <style>html, body {
        margin: 0;
        overflow: hidden
    }</style>
    <title>Projet JS</title>
</head>
<body data-barba="wrapper">
<div class="load-container">
    <div class="loading-screen"></div>
</div>

<div data-barba="container" data-barber-namespace="expe">

</div>

</body>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://unpkg.com/@barba/core"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.4/gsap.min.js"></script>
<script src="https://js.leapmotion.com/leap-0.6.4.js"></script>
<script src="https://cdn.jsdelivr.net/npm/p5@1.1.9/lib/p5.js"></script>
<script src="src/timelines.js"></script>
<script src="src/main.js"></script>
<script>
    let d = new Date();
    d = "" + d.getDate() + d.getMonth() + d.getFullYear() + d.getHours() + d.getMinutes();
    let played = false;

    Leap.loop(function (frame) {
        if (frame.hands.length > 0) {
            let hand = frame.hands[0];
            let position = hand.palmPosition;
            let velocity = hand.palmVelocity;
            let direction = hand.direction;

            var extendedFingers = 0;
            for (let f = 0; f < hand.fingers.length; f++) {
                let finger = hand.fingers[f];
                if (finger.extended) extendedFingers++;
            }

            if (extendedFingers == 0) {
                if (!played) {
                    (() => {
                        const canvas = document.querySelector('canvas')
                        canvas.toBlob(
                            (blob) => {

                                let file = canvas.toDataURL()
                                let title = 'screenshot' + d;

                                const formData = new FormData()
                                formData.append('title', title)
                                formData.append('experiment', blob, 'photo.jpg')

                                fetch('/experiment', {
                                    method: 'POST',
                                    body: formData,
                                }).then(res => console.log(res.text()))

                            },
                            'image/jpeg',
                            0.95,
                        )
                    })()
                    played = !played;
                }
                setTimeout(() => {
                    played = !played;
                }, 2000)
            }

        }
    });


</script>
</html>
